---
title: "Advanced Magic with `pixiedust`"
author: "Benjamin Nutter"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    fig_caption: no
    number_section: yes
    toc: yes
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteIndexEntry{Advanced Magic with pixiedust}
  \usepackage[utf8]{inputenc}
---

In addition to the basic cell-specific customizations covered in the "pixiedust" vignette (`vignette("pixiedust")`), `pixiedust` also supports some more advanced features for displaying tabular output.  Specifically, you can add multi-row headers and footers; display your tables in multiple divisions; and create cells that span multiple columns and/or rows.

The presentation of this vignette will be a hybrid of tutorial and testing environment.  Due to the way that `pixiedust` generates output, it cannot be directly evaluated for accuracy (this may change some day, but not right now) and so the best way to see if it is doing what is expected is to generate the output.  The primary tutorial aspect of this vignette will be covered in the HTML portions, with the Markdown and Console output being provided mostly to verify that the output is expected.

For most of this vignette, we will work with the `mtcars` data frame.  But first we make some additions to the data.  For simplicity, we will only use the first ten rows of the data frame.  Additionally, we will add labels to the variables using the `label` function from the `Hmisc` package.

```{r}
library(pixiedust)

mtcars2 <- mtcars[1:10, ]

Hmisc::label(mtcars2$mpg) <- "Gas Mileage"
Hmisc::label(mtcars2$cyl) <- "Cylinders"
Hmisc::label(mtcars2$disp) <- "Displacement"
Hmisc::label(mtcars2$hp) <- "Horse Power"
Hmisc::label(mtcars2$drat) <- "Rear Axle Ratio"
Hmisc::label(mtcars2$wt) <- "Weight"
Hmisc::label(mtcars2$qsec) <- "1/4 mile time"
Hmisc::label(mtcars2$vs) <- "V/S"
Hmisc::label(mtcars2$am) <- "Transmission"
Hmisc::label(mtcars2$gear) <- "Forward Gears"
Hmisc::label(mtcars2$carb) <- "Carburetors"
```



```{r, warning=FALSE, message = FALSE}
library(pixiedust)


inter <- data.frame("To", "Be", "Con", "tin", "ued",
                    "", "", "", "", "", "")
foot <- as.data.frame(lapply(mtcars, sum))
```

# HTML Output

## Multirow Headers and Footers

To illustrate the multirow headers and footers, we will generate a header that has both the column name and the label.  The footer will summarise the values in each column by mean and standard deviation.

```{r}
custom_head <- rbind(names(mtcars2), Hmisc::label(mtcars2)) %>%
  as.data.frame(stringsAsFactors = FALSE)

custom_foot <- rbind(vapply(mtcars2, mean, numeric(1)),
                     vapply(mtcars2, sd, numeric(1))) %>%
  as.data.frame(stringsAsFactors = FALSE)
```

Now we need only create a `dust` object and add our custom header and footer.  To replace components of the `dust` object, we "`redust`" the component.  We'll also shade the head and foot in different shades of gray to make them stand out.

```{r}
dust(mtcars2) %>%
  redust(custom_head, part = "head") %>%
  redust(custom_foot, part = "foot") %>%
  sprinkle_table(round = 2) %>%
  sprinkle(bg = "gray", part = "head") %>%
  sprinkle(bg = "lightgray", part = "foot") %>%
  sprinkle_print_method("html")
```


## Longtable Feature

The longtable feature is named for the LaTeX package `longtable`, which will automatically break a table into multiple divisions, each of which is displayed on a separate page.  We can use the long table sprinkle to break a table into divisions of any size we like.  In this example, we'll use divisions of four rows each.  We will use the same header and footer as the previous example, and we'll also make use of the _interfoot_, which is the footer placed at the bottom of each intermediate table, while the footer is placed only at the bottom of the last table.  We'll make use of the multi-cell feature for the interfoot here, although we won't really discuss it until the next section.

The code for this table is nearly identical to the previous example.  We just add a `redust` call for the interfoot and add a `longtable` argument to `sprinkle_table`.

```{r}
custom_interfoot <- data.frame("To", "Be", "Con", "tin", "ued",
                               "", "", "", "", "", "")

dust(mtcars2) %>%
  redust(custom_head, part = "head") %>%
  redust(custom_foot, part = "foot") %>%
  redust(custom_interfoot, part = "interfoot") %>%
  sprinkle_table(round = 2, longtable = 4) %>%
  sprinkle(bg = "gray", part = "head") %>%
  sprinkle(bg = "lightgray", part = "foot") %>%
  sprinkle(bg = "lightgray", part = "interfoot") %>%
  sprinkle_print_method("html")
```


## Multi-cell Representations


# Console Output

The console output isn't as sophisticated as the HTML output, and so not all of the sprinkles applied to the HTML table will show up in the console.  Background shading in particular doesn't appear in the console. Multirow headers and footers still work, however.

## Multirow Headers

```{r}
custom_head <- rbind(names(mtcars2), Hmisc::label(mtcars2)) %>%
  as.data.frame(stringsAsFactors = FALSE)

custom_foot <- rbind(vapply(mtcars2, mean, numeric(1)),
                     vapply(mtcars2, sd, numeric(1))) %>%
  as.data.frame(stringsAsFactors = FALSE)
```

```{r}
dust(mtcars2) %>%
  redust(custom_head, part = "head") %>%
  redust(custom_foot, part = "foot") %>%
  sprinkle_table(round = 2) %>%
  sprinkle(bg = "gray", part = "head") %>%
  sprinkle(bg = "lightgray", part = "foot") %>%
  sprinkle_print_method("console")
```

## Longtable Feature

While the longtable feature will work in console output, the multicell features do not.  In this case, we have awkwardly broken the work "Continued" into multiple cells.  I don't recommend doing this, but at some point I may decide to build a more advanced console printing engine (or take advantage of an existing one).  I leave this example as is in anticipating of that day.

```{r}
custom_interfoot <- data.frame("To", "Be", "Con", "tin", "ued",
                               "", "", "", "", "", "")

dust(mtcars2) %>%
  redust(custom_head, part = "head") %>%
  redust(custom_foot, part = "foot") %>%
  redust(custom_interfoot, part = "interfoot") %>%
  sprinkle_table(round = 2, longtable = 4) %>%
  sprinkle(bg = "gray", part = "head") %>%
  sprinkle(bg = "lightgray", part = "foot") %>%
  sprinkle(bg = "lightgray", part = "interfoot") %>%
  sprinkle_print_method("console")
```


## Multi-cell Representations

Multi-cell representations are not available in console output.

# Markdown Output

Markdown output will support some of the features of `pixiedust` a little better, but they are still pretty limited.  Background colors are not supported.  Headers will appear in bold text.  To distinguish the footers, we'll print them in italics.

## Multirow Headers
```{r}
custom_head <- rbind(names(mtcars2), Hmisc::label(mtcars2)) %>%
  as.data.frame(stringsAsFactors = FALSE)

custom_foot <- rbind(vapply(mtcars2, mean, numeric(1)),
                     vapply(mtcars2, sd, numeric(1))) %>%
  as.data.frame(stringsAsFactors = FALSE)
```

```{r}
dust(mtcars2) %>%
  redust(custom_head, part = "head") %>%
  redust(custom_foot, part = "foot") %>%
  sprinkle_table(round = 2) %>%
  sprinkle(italic = TRUE, part = "foot") %>%
  sprinkle_print_method("markdown")
```

## Longtable Feature

While the longtable feature will work in console output, the multicell features do not.  In this case, we have awkwardly broken the work "Continued" into multiple cells.  I don't recommend doing this, but at some point I may decide to build a more advanced console printing engine (or take advantage of an existing one).  I leave this example as is in anticipating of that day.

```{r}
custom_interfoot <- data.frame("To", "Be", "Con", "tin", "ued",
                               "", "", "", "", "", "")

dust(mtcars2) %>%
  redust(custom_head, part = "head") %>%
  redust(custom_foot, part = "foot") %>%
  redust(custom_interfoot, part = "interfoot") %>%
  sprinkle_table(round = 2, longtable = 4) %>%
  sprinkle(italic = TRUE, part = "foot") %>%
  sprinkle(cols = 1:5, italic = TRUE, part = "interfoot") %>%
  sprinkle_print_method("markdown")
```

## Multi-cell Representations

Multi-cell representations are not available in markdown output.